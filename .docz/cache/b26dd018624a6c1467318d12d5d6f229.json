{"remainingRequest":"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/node_modules/babel-loader/lib/index.js?{\"presets\":[[\"@babel/preset-env\",{\"modules\":false,\"targets\":{\"browsers\":[\"last 2 versions\"]}}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-import-meta\",\"@babel/plugin-proposal-class-properties\",\"@babel/plugin-proposal-json-strings\",\"@babel/plugin-proposal-object-rest-spread\",[\"@babel/plugin-proposal-decorators\",{\"legacy\":true}],\"@babel/plugin-proposal-function-sent\",\"@babel/plugin-proposal-export-namespace-from\",\"@babel/plugin-proposal-numeric-separator\",\"@babel/plugin-proposal-throw-expressions\",\"@babel/plugin-proposal-export-default-from\",\"@babel/plugin-proposal-logical-assignment-operators\",\"@babel/plugin-proposal-optional-chaining\",[\"@babel/plugin-proposal-pipeline-operator\",{\"proposal\":\"minimal\"}],\"@babel/plugin-proposal-nullish-coalescing-operator\",\"@babel/plugin-proposal-do-expressions\",\"@babel/plugin-proposal-function-bind\",\"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/node_modules/react-hot-loader/babel.js\"],\"env\":{\"test\":{\"presets\":[\"@babel/preset-env\",\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-import-meta\",\"@babel/plugin-proposal-class-properties\",\"@babel/plugin-proposal-json-strings\",\"@babel/plugin-proposal-object-rest-spread\",[\"@babel/plugin-proposal-decorators\",{\"legacy\":true}],\"@babel/plugin-proposal-function-sent\",\"@babel/plugin-proposal-export-namespace-from\",\"@babel/plugin-proposal-numeric-separator\",\"@babel/plugin-proposal-throw-expressions\",\"@babel/plugin-proposal-export-default-from\",\"@babel/plugin-proposal-logical-assignment-operators\",\"@babel/plugin-proposal-optional-chaining\",[\"@babel/plugin-proposal-pipeline-operator\",{\"proposal\":\"minimal\"}],\"@babel/plugin-proposal-nullish-coalescing-operator\",\"@babel/plugin-proposal-do-expressions\",\"@babel/plugin-proposal-function-bind\"]}},\"cacheDirectory\":true,\"babelrc\":false}!/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/src/stage/index.js","dependencies":[{"path":"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/src/stage/index.js","mtime":1531323900000},{"path":"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/node_modules/cache-loader/dist/cjs.js","mtime":0},{"path":"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/node_modules/babel-loader/lib/index.js","mtime":1529635966000}],"contextDependencies":[],"result":["(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nimport React from 'react';\nimport * as PIXI from 'pixi.js';\nimport PropTypes from 'prop-types';\nimport invariant from 'fbjs/lib/invariant';\nimport { PROPS_DISPLAY_OBJECT } from '../utils/props';\nimport { runningInBrowser } from '../helpers';\nimport { PixiFiber } from '../reconciler';\nimport { injectDevtools } from '../render';\nimport { context } from './provider';\n\nvar noop = function noop() {};\n/**\n * -------------------------------------------\n * Stage React Component (use this in react-dom)\n *\n * @usage\n *\n *    const App = () => (\n *      <Stage width={500}\n *             height={500}\n *             options={ backgroundColor: 0xff0000 }\n *             onMount={( renderer, canvas ) => {\n *               console.log('PIXI renderer: ', renderer)\n *               console.log('Canvas element: ', canvas)\n *             }}>\n *    )\n *\n * -------------------------------------------\n */\n\n\nvar propTypes = {\n  // dimensions\n  width: PropTypes.number,\n  height: PropTypes.number,\n  // will return renderer\n  onMount: PropTypes.func,\n  onUnmount: PropTypes.func,\n  // run ticker at start?\n  raf: PropTypes.bool,\n  // render component on component lifecycle changes?\n  renderOnComponentChange: PropTypes.bool,\n  children: PropTypes.node,\n  // PIXI options, see http://pixijs.download/dev/docs/PIXI.Application.html\n  options: PropTypes.shape({\n    antialias: PropTypes.bool,\n    autoStart: PropTypes.bool,\n    width: PropTypes.number,\n    height: PropTypes.number,\n    transparent: PropTypes.bool,\n    preserveDrawingBuffer: PropTypes.bool,\n    resolution: PropTypes.number,\n    forceCanvas: PropTypes.bool,\n    backgroundColor: PropTypes.number,\n    clearBeforeRender: PropTypes.bool,\n    roundPixels: PropTypes.bool,\n    forceFXAA: PropTypes.bool,\n    legacy: PropTypes.bool,\n    powerPreference: PropTypes.string,\n    sharedTicker: PropTypes.bool,\n    sharedLoader: PropTypes.bool,\n    // view is optional, use if provided\n    view: function view(props, propName, componentName) {\n      var el = props[propName];\n\n      if (el === undefined) {\n        return;\n      }\n\n      invariant(el instanceof HTMLCanvasElement, \"Invalid prop `view` of type \".concat(_typeof(el), \", supplied to \").concat(componentName, \", expected `<canvas> Element`\"));\n    }\n  })\n};\nvar defaultProps = {\n  width: 800,\n  height: 600,\n  onMount: noop,\n  onUnmount: noop,\n  raf: true,\n  renderOnComponentChange: true\n};\nexport function getCanvasProps(props) {\n  var reserved = _toConsumableArray(Object.keys(propTypes)).concat(_toConsumableArray(Object.keys(PROPS_DISPLAY_OBJECT)));\n\n  return Object.keys(props).filter(function (p) {\n    return !reserved.includes(p);\n  }).reduce(function (all, prop) {\n    return _objectSpread({}, all, _defineProperty({}, prop, props[prop]));\n  }, {});\n}\n\nvar Stage =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Stage, _React$Component);\n\n  function Stage() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Stage);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Stage)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"_canvas\", null);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"app\", null);\n\n    return _this;\n  }\n\n  _createClass(Stage, [{\n    key: \"UNSAFE_componentWillMount\",\n    value: function UNSAFE_componentWillMount() {\n      invariant(runningInBrowser(), \"Cannot mount Stage, window object is not defined\");\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this$props = this.props,\n          onMount = _this$props.onMount,\n          width = _this$props.width,\n          height = _this$props.height,\n          options = _this$props.options,\n          raf = _this$props.raf;\n      this.app = new PIXI.Application(width, height, _objectSpread({}, options, {\n        view: this._canvas\n      }));\n\n      if (!raf) {\n        this.app.ticker.stop();\n        this.app.ticker.autoStart = false;\n      }\n\n      this.mountNode = PixiFiber.createContainer(this.app.stage);\n      PixiFiber.updateContainer(this.getChildren(), this.mountNode, this);\n      injectDevtools();\n      onMount(this.app);\n      this.renderStage();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState, prevContext) {\n      var _this$props2 = this.props,\n          width = _this$props2.width,\n          height = _this$props2.height; // handle resize\n\n      if (prevProps.height !== height || prevProps.width !== width) {\n        this.app.renderer.resize(width, height);\n      } // handle resolution ?\n      // flush fiber\n\n\n      PixiFiber.updateContainer(this.getChildren(), this.mountNode, this);\n      this.renderStage();\n    }\n  }, {\n    key: \"getChildren\",\n    value: function getChildren() {\n      var children = this.props.children;\n      return React.createElement(context.Provider, {\n        value: this.app\n      }, children);\n    }\n  }, {\n    key: \"componentDidCatch\",\n    value: function componentDidCatch(error, errorInfo) {\n      console.error(\"Error occurred in `Stage`.\");\n      console.error(error);\n      console.error(errorInfo);\n    }\n  }, {\n    key: \"renderStage\",\n    value: function renderStage() {\n      var _this$props3 = this.props,\n          renderOnComponentChange = _this$props3.renderOnComponentChange,\n          raf = _this$props3.raf;\n\n      if (!raf && renderOnComponentChange) {\n        this.app.renderer.render(this.app.stage);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.onUnmount(this.app);\n      PixiFiber.updateContainer(null, this.mountNode, this);\n      this.renderStage();\n      this.app.destroy();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var options = this.props.options;\n\n      if (options && options.view) {\n        invariant(options.view instanceof HTMLCanvasElement, 'options.view needs to be a `HTMLCanvasElement`');\n        return null;\n      }\n\n      return React.createElement(\"canvas\", _extends({}, getCanvasProps(this.props), {\n        ref: function ref(c) {\n          return _this2._canvas = c;\n        }\n      }));\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    // @ts-ignore\n    value: function __reactstandin__regenerateByEval(key, code) {\n      // @ts-ignore\n      this[key] = eval(code);\n    }\n  }]);\n\n  return Stage;\n}(React.Component);\n\nStage.propTypes = propTypes;\nStage.defaultProps = defaultProps;\nvar _default = Stage;\nexport default _default;\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(noop, \"noop\", \"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/src/stage/index.js\");\n  reactHotLoader.register(propTypes, \"propTypes\", \"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/src/stage/index.js\");\n  reactHotLoader.register(defaultProps, \"defaultProps\", \"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/src/stage/index.js\");\n  reactHotLoader.register(getCanvasProps, \"getCanvasProps\", \"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/src/stage/index.js\");\n  reactHotLoader.register(Stage, \"Stage\", \"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/src/stage/index.js\");\n  reactHotLoader.register(_default, \"default\", \"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber/src/stage/index.js\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["src/stage/index.js"],"names":["React","PIXI","PropTypes","invariant","PROPS_DISPLAY_OBJECT","runningInBrowser","PixiFiber","injectDevtools","context","noop","propTypes","width","number","height","onMount","func","onUnmount","raf","bool","renderOnComponentChange","children","node","options","shape","antialias","autoStart","transparent","preserveDrawingBuffer","resolution","forceCanvas","backgroundColor","clearBeforeRender","roundPixels","forceFXAA","legacy","powerPreference","string","sharedTicker","sharedLoader","view","props","propName","componentName","el","undefined","HTMLCanvasElement","defaultProps","getCanvasProps","reserved","Object","keys","filter","p","includes","reduce","all","prop","Stage","app","Application","_canvas","ticker","stop","mountNode","createContainer","stage","updateContainer","getChildren","renderStage","prevProps","prevState","prevContext","renderer","resize","error","errorInfo","console","render","destroy","c","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,KAAKC,IAAZ,MAAsB,SAAtB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AACA,SAASC,oBAAT,QAAqC,gBAArC;AACA,SAASC,gBAAT,QAAiC,YAAjC;AACA,SAASC,SAAT,QAA0B,eAA1B;AACA,SAASC,cAAT,QAA+B,WAA/B;AACA,SAASC,OAAT,QAAwB,YAAxB;;AAEA,IAAMC,IAAI,GAAG,SAAPA,IAAO,GAAM,CAAE,CAArB;AAEA;;;;;;;;;;;;;;;;;;;;AAmBA,IAAMC,SAAS,GAAG;AAChB;AACAC,EAAAA,KAAK,EAAET,SAAS,CAACU,MAFD;AAGhBC,EAAAA,MAAM,EAAEX,SAAS,CAACU,MAHF;AAKhB;AACAE,EAAAA,OAAO,EAAEZ,SAAS,CAACa,IANH;AAOhBC,EAAAA,SAAS,EAAEd,SAAS,CAACa,IAPL;AAShB;AACAE,EAAAA,GAAG,EAAEf,SAAS,CAACgB,IAVC;AAYhB;AACAC,EAAAA,uBAAuB,EAAEjB,SAAS,CAACgB,IAbnB;AAehBE,EAAAA,QAAQ,EAAElB,SAAS,CAACmB,IAfJ;AAiBhB;AACAC,EAAAA,OAAO,EAAEpB,SAAS,CAACqB,KAAV,CAAgB;AACvBC,IAAAA,SAAS,EAAEtB,SAAS,CAACgB,IADE;AAEvBO,IAAAA,SAAS,EAAEvB,SAAS,CAACgB,IAFE;AAGvBP,IAAAA,KAAK,EAAET,SAAS,CAACU,MAHM;AAIvBC,IAAAA,MAAM,EAAEX,SAAS,CAACU,MAJK;AAKvBc,IAAAA,WAAW,EAAExB,SAAS,CAACgB,IALA;AAMvBS,IAAAA,qBAAqB,EAAEzB,SAAS,CAACgB,IANV;AAOvBU,IAAAA,UAAU,EAAE1B,SAAS,CAACU,MAPC;AAQvBiB,IAAAA,WAAW,EAAE3B,SAAS,CAACgB,IARA;AASvBY,IAAAA,eAAe,EAAE5B,SAAS,CAACU,MATJ;AAUvBmB,IAAAA,iBAAiB,EAAE7B,SAAS,CAACgB,IAVN;AAWvBc,IAAAA,WAAW,EAAE9B,SAAS,CAACgB,IAXA;AAYvBe,IAAAA,SAAS,EAAE/B,SAAS,CAACgB,IAZE;AAavBgB,IAAAA,MAAM,EAAEhC,SAAS,CAACgB,IAbK;AAcvBiB,IAAAA,eAAe,EAAEjC,SAAS,CAACkC,MAdJ;AAevBC,IAAAA,YAAY,EAAEnC,SAAS,CAACgB,IAfD;AAgBvBoB,IAAAA,YAAY,EAAEpC,SAAS,CAACgB,IAhBD;AAkBvB;AACAqB,IAAAA,IAAI,EAAE,cAACC,KAAD,EAAQC,QAAR,EAAkBC,aAAlB,EAAoC;AACxC,UAAMC,EAAE,GAAGH,KAAK,CAACC,QAAD,CAAhB;;AACA,UAAIE,EAAE,KAAKC,SAAX,EAAsB;AACpB;AACD;;AACDzC,MAAAA,SAAS,CACPwC,EAAE,YAAYE,iBADP,gDAEiCF,EAFjC,4BAEoDD,aAFpD,mCAAT;AAID;AA5BsB,GAAhB;AAlBO,CAAlB;AAkDA,IAAMI,YAAY,GAAG;AACnBnC,EAAAA,KAAK,EAAE,GADY;AAEnBE,EAAAA,MAAM,EAAE,GAFW;AAGnBC,EAAAA,OAAO,EAAEL,IAHU;AAInBO,EAAAA,SAAS,EAAEP,IAJQ;AAKnBQ,EAAAA,GAAG,EAAE,IALc;AAMnBE,EAAAA,uBAAuB,EAAE;AANN,CAArB;AASA,OAAO,SAAS4B,cAAT,CAAwBP,KAAxB,EAA+B;AACpC,MAAMQ,QAAQ,sBAAOC,MAAM,CAACC,IAAP,CAAYxC,SAAZ,CAAP,4BAAkCuC,MAAM,CAACC,IAAP,CAAY9C,oBAAZ,CAAlC,EAAd;;AAEA,SAAO6C,MAAM,CAACC,IAAP,CAAYV,KAAZ,EACJW,MADI,CACG,UAAAC,CAAC;AAAA,WAAI,CAACJ,QAAQ,CAACK,QAAT,CAAkBD,CAAlB,CAAL;AAAA,GADJ,EAEJE,MAFI,CAEG,UAACC,GAAD,EAAMC,IAAN;AAAA,6BAAqBD,GAArB,sBAA2BC,IAA3B,EAAkChB,KAAK,CAACgB,IAAD,CAAvC;AAAA,GAFH,EAEqD,EAFrD,CAAP;AAGD;;IAEKC,K;;;;;;;;;;;;;;;;;;sFACM,I;;kFACJ,I;;;;;;;gDAEsB;AAC1BtD,MAAAA,SAAS,CAACE,gBAAgB,EAAjB,qDAAT;AACD;;;wCAEmB;AAAA,wBAC+B,KAAKmC,KADpC;AAAA,UACV1B,OADU,eACVA,OADU;AAAA,UACDH,KADC,eACDA,KADC;AAAA,UACME,MADN,eACMA,MADN;AAAA,UACcS,OADd,eACcA,OADd;AAAA,UACuBL,GADvB,eACuBA,GADvB;AAGlB,WAAKyC,GAAL,GAAW,IAAIzD,IAAI,CAAC0D,WAAT,CAAqBhD,KAArB,EAA4BE,MAA5B,oBACNS,OADM;AAETiB,QAAAA,IAAI,EAAE,KAAKqB;AAFF,SAAX;;AAKA,UAAI,CAAC3C,GAAL,EAAU;AACR,aAAKyC,GAAL,CAASG,MAAT,CAAgBC,IAAhB;AACA,aAAKJ,GAAL,CAASG,MAAT,CAAgBpC,SAAhB,GAA4B,KAA5B;AACD;;AAED,WAAKsC,SAAL,GAAiBzD,SAAS,CAAC0D,eAAV,CAA0B,KAAKN,GAAL,CAASO,KAAnC,CAAjB;AACA3D,MAAAA,SAAS,CAAC4D,eAAV,CAA0B,KAAKC,WAAL,EAA1B,EAA8C,KAAKJ,SAAnD,EAA8D,IAA9D;AAEAxD,MAAAA,cAAc;AAEdO,MAAAA,OAAO,CAAC,KAAK4C,GAAN,CAAP;AACA,WAAKU,WAAL;AACD;;;uCAEkBC,S,EAAWC,S,EAAWC,W,EAAa;AAAA,yBAC1B,KAAK/B,KADqB;AAAA,UAC5C7B,KAD4C,gBAC5CA,KAD4C;AAAA,UACrCE,MADqC,gBACrCA,MADqC,EAGpD;;AACA,UAAIwD,SAAS,CAACxD,MAAV,KAAqBA,MAArB,IAA+BwD,SAAS,CAAC1D,KAAV,KAAoBA,KAAvD,EAA8D;AAC5D,aAAK+C,GAAL,CAASc,QAAT,CAAkBC,MAAlB,CAAyB9D,KAAzB,EAAgCE,MAAhC;AACD,OANmD,CAQpD;AAEA;;;AACAP,MAAAA,SAAS,CAAC4D,eAAV,CAA0B,KAAKC,WAAL,EAA1B,EAA8C,KAAKJ,SAAnD,EAA8D,IAA9D;AACA,WAAKK,WAAL;AACD;;;kCAEa;AAAA,UACJhD,QADI,GACS,KAAKoB,KADd,CACJpB,QADI;AAEZ,aAAO,oBAAC,OAAD,CAAS,QAAT;AAAkB,QAAA,KAAK,EAAE,KAAKsC;AAA9B,SAAoCtC,QAApC,CAAP;AACD;;;sCAEiBsD,K,EAAOC,S,EAAW;AAClCC,MAAAA,OAAO,CAACF,KAAR;AACAE,MAAAA,OAAO,CAACF,KAAR,CAAcA,KAAd;AACAE,MAAAA,OAAO,CAACF,KAAR,CAAcC,SAAd;AACD;;;kCAEa;AAAA,yBAC6B,KAAKnC,KADlC;AAAA,UACJrB,uBADI,gBACJA,uBADI;AAAA,UACqBF,GADrB,gBACqBA,GADrB;;AAGZ,UAAI,CAACA,GAAD,IAAQE,uBAAZ,EAAqC;AACnC,aAAKuC,GAAL,CAASc,QAAT,CAAkBK,MAAlB,CAAyB,KAAKnB,GAAL,CAASO,KAAlC;AACD;AACF;;;2CAEsB;AACrB,WAAKzB,KAAL,CAAWxB,SAAX,CAAqB,KAAK0C,GAA1B;AAEApD,MAAAA,SAAS,CAAC4D,eAAV,CAA0B,IAA1B,EAAgC,KAAKH,SAArC,EAAgD,IAAhD;AACA,WAAKK,WAAL;AACA,WAAKV,GAAL,CAASoB,OAAT;AACD;;;6BAEQ;AAAA;;AAAA,UACCxD,OADD,GACa,KAAKkB,KADlB,CACClB,OADD;;AAGP,UAAIA,OAAO,IAAIA,OAAO,CAACiB,IAAvB,EAA6B;AAC3BpC,QAAAA,SAAS,CAACmB,OAAO,CAACiB,IAAR,YAAwBM,iBAAzB,EAA4C,gDAA5C,CAAT;AACA,eAAO,IAAP;AACD;;AAED,aAAO,2CAAYE,cAAc,CAAC,KAAKP,KAAN,CAA1B;AAAwC,QAAA,GAAG,EAAE,aAAAuC,CAAC;AAAA,iBAAK,MAAI,CAACnB,OAAL,GAAemB,CAApB;AAAA;AAA9C,SAAP;AACD;;;;;;;;;;;EAjFiB/E,KAAK,CAACgF,S;;AAoF1BvB,KAAK,CAAC/C,SAAN,GAAkBA,SAAlB;AACA+C,KAAK,CAACX,YAAN,GAAqBA,YAArB;eAEeW,K;AAAf;;;;;;;;;;;;0BA/KMhD,I;0BAqBAC,S;0BAkDAoC,Y;0BASUC,c;0BAQVU,K","sourceRoot":"/Users/pbrouwer/Documents/work/inlet/repos/react-pixi-fiber","sourcesContent":["import React from 'react'\nimport * as PIXI from 'pixi.js'\nimport PropTypes from 'prop-types'\nimport invariant from 'fbjs/lib/invariant'\nimport { PROPS_DISPLAY_OBJECT } from '../utils/props'\nimport { runningInBrowser } from '../helpers'\nimport { PixiFiber } from '../reconciler'\nimport { injectDevtools } from '../render'\nimport { context } from './provider'\n\nconst noop = () => {}\n\n/**\n * -------------------------------------------\n * Stage React Component (use this in react-dom)\n *\n * @usage\n *\n *    const App = () => (\n *      <Stage width={500}\n *             height={500}\n *             options={ backgroundColor: 0xff0000 }\n *             onMount={( renderer, canvas ) => {\n *               console.log('PIXI renderer: ', renderer)\n *               console.log('Canvas element: ', canvas)\n *             }}>\n *    )\n *\n * -------------------------------------------\n */\n\nconst propTypes = {\n  // dimensions\n  width: PropTypes.number,\n  height: PropTypes.number,\n\n  // will return renderer\n  onMount: PropTypes.func,\n  onUnmount: PropTypes.func,\n\n  // run ticker at start?\n  raf: PropTypes.bool,\n\n  // render component on component lifecycle changes?\n  renderOnComponentChange: PropTypes.bool,\n\n  children: PropTypes.node,\n\n  // PIXI options, see http://pixijs.download/dev/docs/PIXI.Application.html\n  options: PropTypes.shape({\n    antialias: PropTypes.bool,\n    autoStart: PropTypes.bool,\n    width: PropTypes.number,\n    height: PropTypes.number,\n    transparent: PropTypes.bool,\n    preserveDrawingBuffer: PropTypes.bool,\n    resolution: PropTypes.number,\n    forceCanvas: PropTypes.bool,\n    backgroundColor: PropTypes.number,\n    clearBeforeRender: PropTypes.bool,\n    roundPixels: PropTypes.bool,\n    forceFXAA: PropTypes.bool,\n    legacy: PropTypes.bool,\n    powerPreference: PropTypes.string,\n    sharedTicker: PropTypes.bool,\n    sharedLoader: PropTypes.bool,\n\n    // view is optional, use if provided\n    view: (props, propName, componentName) => {\n      const el = props[propName]\n      if (el === undefined) {\n        return\n      }\n      invariant(\n        el instanceof HTMLCanvasElement,\n        `Invalid prop \\`view\\` of type ${typeof el}, supplied to ${componentName}, expected \\`<canvas> Element\\``\n      )\n    },\n  }),\n}\n\nconst defaultProps = {\n  width: 800,\n  height: 600,\n  onMount: noop,\n  onUnmount: noop,\n  raf: true,\n  renderOnComponentChange: true,\n}\n\nexport function getCanvasProps(props) {\n  const reserved = [...Object.keys(propTypes), ...Object.keys(PROPS_DISPLAY_OBJECT)]\n\n  return Object.keys(props)\n    .filter(p => !reserved.includes(p))\n    .reduce((all, prop) => ({ ...all, [prop]: props[prop] }), {})\n}\n\nclass Stage extends React.Component {\n  _canvas = null\n  app = null\n\n  UNSAFE_componentWillMount() {\n    invariant(runningInBrowser(), `Cannot mount Stage, window object is not defined`)\n  }\n\n  componentDidMount() {\n    const { onMount, width, height, options, raf } = this.props\n\n    this.app = new PIXI.Application(width, height, {\n      ...options,\n      view: this._canvas,\n    })\n\n    if (!raf) {\n      this.app.ticker.stop()\n      this.app.ticker.autoStart = false\n    }\n\n    this.mountNode = PixiFiber.createContainer(this.app.stage)\n    PixiFiber.updateContainer(this.getChildren(), this.mountNode, this)\n\n    injectDevtools()\n\n    onMount(this.app)\n    this.renderStage()\n  }\n\n  componentDidUpdate(prevProps, prevState, prevContext) {\n    const { width, height } = this.props\n\n    // handle resize\n    if (prevProps.height !== height || prevProps.width !== width) {\n      this.app.renderer.resize(width, height)\n    }\n\n    // handle resolution ?\n\n    // flush fiber\n    PixiFiber.updateContainer(this.getChildren(), this.mountNode, this)\n    this.renderStage()\n  }\n\n  getChildren() {\n    const { children } = this.props\n    return <context.Provider value={this.app}>{children}</context.Provider>\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.error(`Error occurred in \\`Stage\\`.`)\n    console.error(error)\n    console.error(errorInfo)\n  }\n\n  renderStage() {\n    const { renderOnComponentChange, raf } = this.props\n\n    if (!raf && renderOnComponentChange) {\n      this.app.renderer.render(this.app.stage)\n    }\n  }\n\n  componentWillUnmount() {\n    this.props.onUnmount(this.app)\n\n    PixiFiber.updateContainer(null, this.mountNode, this)\n    this.renderStage()\n    this.app.destroy()\n  }\n\n  render() {\n    const { options } = this.props\n\n    if (options && options.view) {\n      invariant(options.view instanceof HTMLCanvasElement, 'options.view needs to be a `HTMLCanvasElement`')\n      return null\n    }\n\n    return <canvas {...getCanvasProps(this.props)} ref={c => (this._canvas = c)} />\n  }\n}\n\nStage.propTypes = propTypes\nStage.defaultProps = defaultProps\n\nexport default Stage\n"]}]}